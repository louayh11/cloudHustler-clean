<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


<!-- Zone de déclenchement à gauche >
<div class="hover-trigger-area" (mouseenter)="showNavbar()" (mouseleave)="hideNavbar()"></div>


<app-side-bar [class.visible]="isNavbarVisible"></app-side-bar>


<div class="main-content" [class.sidebar-visible]="isNavbarVisible">
   Navbar conditionnelle -->
   <div class="g-sidenav-show bg-gray-100">
    <div style="position: absolute; min-height: 300px; width: 100%; overflow: hidden;">
        <img src="../../../../assets/img/bg-img/1.jpg" alt="Background Image" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; filter: blur(5px) brightness(80%);">
    </div>
    <app-side-bar></app-side-bar>
    <main class="main-content position-relative border-radius-lg">
      <app-navbar></app-navbar>
      <div class="container-fluid py-4">
<div class="details-facture-container" *ngIf="facture">
  <div class="details-header">
    <h2 class="details-title">Invoice Details #{{facture.id}}</h2>
    <div class="action-buttons">
      <button class="btn btn-edit" (click)="editFacture()" *ngIf="!isEditing">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
    </div>
  </div>

  <div class="details-section" *ngIf="!isEditing">
    <h3 class="section-title">General Information</h3>
    <div class="detail-grid">
      <div class="detail-item">
        <span class="detail-label">Issue Date</span>
        <span class="detail-value">{{facture.dateEmission | date:'dd/MM/yyyy'}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Total Amount</span>
        <span class="detail-value">{{facture.montantTotal | number:'1.2-2'}} DT</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Status</span>
        <span class="status-badge" [ngClass]="'status-' + facture.statut?.toLowerCase()">
          {{facture.statut}}
        </span>
      </div>
    </div>
  </div>

  <div class="details-section" *ngIf="facture.livraison">
    <h3 class="section-title">Delivery Details</h3>
    <div class="detail-grid">
      <div class="detail-item">
        <span class="detail-label">Delivery ID</span>
        <span class="detail-value">{{ facture.livraison.id }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Delivery Address</span>
        <span class="detail-value">{{ facture.livraison.adresseLivraison }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Creation Date</span>
        <span class="detail-value">{{ facture.livraison.dateCreation | date:'dd/MM/yyyy' }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Delivery Status</span>
        <span class="detail-value">{{ facture.livraison.statut }}</span>
      </div>
    </div>
  </div>

  <form [formGroup]="editForm" *ngIf="isEditing" class="details-section" (ngSubmit)="saveChanges()">
    <h3 class="section-title">Edit Invoice</h3>
    <div class="detail-grid">
      <div class="detail-item">
        <label class="detail-label" for="dateEmission">Issue Date</label>
        <input 
          class="edit-input"
          type="date" 
          id="dateEmission" 
          formControlName="dateEmission"
          [min]="creationDate" 
          [max]="today"
          [class.is-invalid]="editForm.get('dateEmission')?.invalid && editForm.get('dateEmission')?.touched"
        />
      </div>
      <div class="detail-item">
        <label class="detail-label" for="montantTotal">Total Amount</label>
        <input 
          class="edit-input"
          type="number" 
          id="montantTotal" 
          formControlName="montantTotal"
          [class.is-invalid]="editForm.get('montantTotal')?.invalid && editForm.get('montantTotal')?.touched"
        >
      </div>
      <div class="detail-item">
        <label class="detail-label" for="statut">Status</label>
        <select 
          class="edit-select"
          id="statut" 
          formControlName="statut"
          [class.is-invalid]="editForm.get('statut')?.invalid && editForm.get('statut')?.touched"
        >
          <option value="Paid">Paid</option>
          <option value="Pending">Pending</option>
          <option value="Cancelled">Cancelled</option>
        </select>
      </div>
    </div>

    <div class="action-buttons" style="margin-top: 2rem;">
      <button type="submit" class="btn btn-save" [disabled]="editForm.invalid || isSaving">
        <mat-icon>save</mat-icon> 
        {{isSaving ? 'Saving...' : 'Save'}}
      </button>
      <button type="button" class="btn btn-cancel" (click)="cancelEdit()">
        <mat-icon>close</mat-icon> Cancel
      </button>
      
    </div>
  </form>
  <!--app-settings-panel></app-settings-panel-->

</div>
