<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<app-side-bar></app-side-bar>

<div class="details-facture-container" *ngIf="facture">
  <div class="details-header">
    <h2 class="details-title">Détails de la Facture #{{facture.id}}</h2>
    <div class="action-buttons">
      <button class="btn btn-edit" (click)="editFacture()" *ngIf="!isEditing">
        <mat-icon>edit</mat-icon>
        Modifier
      </button>
    </div>
  </div>

  <div class="details-section" *ngIf="!isEditing">
    <h3 class="section-title">Informations Générales</h3>
    <div class="detail-grid">
      <div class="detail-item">
        <span class="detail-label">Date d'émission</span>
        <span class="detail-value">{{facture.dateEmission | date:'dd/MM/yyyy'}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Montant total</span>
        <span class="detail-value">{{facture.montantTotal | number:'1.2-2'}} DT</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Statut</span>
        <span class="status-badge" [ngClass]="'status-' + facture.statut?.toLowerCase()">
          {{facture.statut}}
        </span>
      </div>
    </div>
  </div>

  <div class="details-section" *ngIf="facture.livraison">
    <h3 class="section-title">Détails de la Livraison</h3>
    <div class="detail-grid">
      <div class="detail-item">
        <span class="detail-label">ID de Livraison</span>
        <span class="detail-value">{{ facture.livraison.id }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Adresse de Livraison</span>
        <span class="detail-value">{{ facture.livraison.adresseLivraison }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Date de Création</span>
        <span class="detail-value">{{ facture.livraison.dateCreation | date:'dd/MM/yyyy' }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Statut de la Livraison</span>
        <span class="detail-value">{{ facture.livraison.statut }}</span>
      </div>
    </div>
  </div>

  <form [formGroup]="editForm" *ngIf="isEditing" class="details-section">
    <h3 class="section-title">Modifier la Facture</h3>
    <div class="detail-grid">
      <div class="detail-item">
        <label class="detail-label" for="dateEmission">Date d'émission</label>
        <input 
          class="edit-input"
          type="date" 
          id="dateEmission" 
          formControlName="dateEmission"
          [class.is-invalid]="editForm.get('dateEmission')?.invalid && editForm.get('dateEmission')?.touched"
        >
      </div>
      <div class="detail-item">
        <label class="detail-label" for="montantTotal">Montant total</label>
        <input 
          class="edit-input"
          type="number" 
          id="montantTotal" 
          formControlName="montantTotal"
          [class.is-invalid]="editForm.get('montantTotal')?.invalid && editForm.get('montantTotal')?.touched"
        >
      </div>
      <div class="detail-item">
        <label class="detail-label" for="statut">Statut</label>
        <select 
          class="edit-select"
          id="statut" 
          formControlName="statut"
          [class.is-invalid]="editForm.get('statut')?.invalid && editForm.get('statut')?.touched"
        >
          <option value="PAYÉE">Payée</option>
          <option value="EN ATTENTE">En attente</option>
          <option value="ANNULÉE">Annulée</option>
        </select>
      </div>
    </div>

    <div class="action-buttons" style="margin-top: 2rem;">
      <button type="submit" class="btn btn-pdf" [disabled]="editForm.invalid || isSaving">
        <mat-icon>save</mat-icon> 
        {{isSaving ? 'Enregistrement...' : 'Enregistrer'}}
      </button>
      <button type="button" class="btn btn-cancel" (click)="cancelEdit()">
        <mat-icon>close</mat-icon> Annuler
      </button>
      <button class="btn btn-pdf" (click)="generatePDF()">
        <mat-icon>picture_as_pdf</mat-icon> Générer PDF
      </button>
    </div>
  </form>
</div>
